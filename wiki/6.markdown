<!---title:获取文件CRC32值-->
<!---category:代码片段-->
<!---tags:C语言, crc32-->
<!---author:Neal-->
<!---date:2016-03-21-->

这是一段获取文件CRC32值的代码，与WinRAR内CRC32值相同。
````````````````````````````````````````````````````````````{.c}
#include <stdio.h>
#include <stdint.h>
#include <libgen.h>

#define POLY 0xEDB88320U
static uint32_t crc32_table[256];

static void init_crc32_table(void)
{
    uint32_t crc32;
    int i, j;

    for (i = 0; i < 256; i++)
    {
        crc32 = (uint32_t)i;
        for (j = 0; j < 8; j++) 
        {
            if (crc32 & 0x00000001U)
                crc32 = (crc32 >> 1) ^ POLY;
            else
                crc32 = crc32 >> 1;
        }
        crc32_table[i] = crc32;
    }
}

static uint32_t get_buff_crc32(uint32_t crc32init, uint8_t *buff, uint32_t buffsize)
{
    uint32_t crc32;
    crc32 = crc32init ^ 0xFFFFFFFFU;
    while(buffsize--)
        crc32 = (crc32 >> 8) ^ crc32_table[(crc32 & 0x000000FFU) ^ *buff++];

    return crc32 ^ 0xFFFFFFFFU;
}

uint32_t get_file_crc32(const char *file)
{
    uint32_t size = 0x00100000U;
    uint8_t buff[size];
    uint32_t length;
    uint32_t crc32 = 0;

    FILE *fd = fopen(file, "r");
    if(fd == NULL) return 0;
    init_crc32_table();
    while((length = fread(buff, sizeof(uint8_t), size, fd)) > 0)
        crc32 = get_buff_crc32(crc32, buff, length);
    fclose(fd);

    return crc32;
}

int main(int argc, char **argv)
{
    if(argc != 2)
    {
        printf("Usage: %s file\n", basename(argv[0]));
        return 1;
    }

    uint32_t crc32 = get_file_crc32(argv[1]);
    printf("CRC32: %08X\n", crc32);

    return 0;
}
````````````````````````````````````````````````````````````
